defaults:
  - base
  - _self_

data:
  batcher:
    _target_: "trax.data.batcher"
    data_streams: "${data.data_streams}"
    batch_size_per_device: 256
    eval_batch_size: 64
    max_eval_length: 512
    bucket_length: 32
    buckets_include_inputs_in_length: true
  data_streams:
    _target_: "trax.data.tf_dataset_streams_serial"
    _partial_: true
    datasets: "${data.dataset_loader}"
    preprocess_fn: "${data.GenericTextPreprocess}"
  dataset_loader:
    _target_: "trax.data.data_streams"
    _partial_: true
    data_dir: null
    eval_holdout_size: 0.1
    dataset_name: "para_crawl/enpl_plain_text"
  FilterByLengthMap:
    _target_: "trax.data.FilterByLengthMap"
    _partial_: true
    len_map:
      inputs: "(1, 512)"
      targets: "(1, 512)"
    filter_on_eval: true
  TruncateByLengthMap:
    _target_: "trax.data.TruncateByLengthMap"
    _partial_: true
    len_map:
      inputs: 512
      targets: 512
    truncate_on_eval: true
  GenericTextPreprocess:
    _target_: "trax.data.GenericTextPreprocess"
    _partial_: true
    spm_path: "gs://t5-data/vocabs/cc_all.32000/sentencepiece.model"
    text_preprocess_fns:
      - "${data.Rekey}"
    token_preprocess_fns:
      - "${data.AddEOS}"
      - "${data.TruncateByLengthMap}"
      - "${data.FilterByLengthMap}"
  Rekey:
    _target_: "trax.data.Rekey"
    _partial_: true
    key_map:
      inputs: "en"
      targets: "pl"
  AddEOS:
    _target_: "trax.data.AddEOS"
    _partial_: true
