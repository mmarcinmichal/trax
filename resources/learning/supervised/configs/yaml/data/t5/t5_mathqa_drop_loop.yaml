defaults:
  - /data/base
  - _self_

data:
  Tokenize:
    _target_: "trax.data.Tokenize"
    keys:
      - 0
      - 1
    vocab_file: "en_32k.subword"
  make_streams:
    _target_: "trax.data.make_streams"
    _partial_: true
    eval_stream:
      - "${data.eval.CreateMathQAInputs}"
      - "${data.Tokenize}"
      - "${data.Shuffle}"
      - "${data.PadToLength}"
      - "${data.TruncateToLength}"
      - "${data.Batch}"
    train_stream: "${data.make_parallel_stream}"
  train_full_inference:
    make_additional_stream:
      _target_: "trax.data.make_additional_stream"
      _partial_: true
      stream:
        - "${data.train_full_inference.CreateMathQAInputs}"
        - "${data.Tokenize}"
        - "${data.Shuffle}"
        - "${data.PadToLength}"
        - "${data.TruncateToLength}"
        - "${data.Batch}"
    CreateMathQAInputs:
      _target_: "trax.data.CreateMathQAInputs"
      dataset_path: "path_to_the_dataset"
      train: true
      tolerance: 0.01
      cumulative: false
  eval_full_inference:
    make_additional_stream:
      _target_: "trax.data.make_additional_stream"
      stream:
        - "${data.eval_full_inference.CreateMathQAInputs}"
        - "${data.Tokenize}"
        - "${data.Shuffle}"
        - "${data.PadToLength}"
        - "${data.TruncateToLength}"
        - "${data.Batch}"
    CreateMathQAInputs:
      _target_: "trax.data.CreateMathQAInputs"
      dataset_path: "path_to_the_dataset"
      train: false
      tolerance: 0.01
      cumulative: false
  train_basic_task:
    make_additional_stream:
      _target_: "trax.data.make_additional_stream"
      _partial_: true
      stream:
        - "${data.train_basic_task.CreateMathQAInputs}"
        - "${data.Tokenize}"
        - "${data.Shuffle}"
        - "${data.PadToLength}"
        - "${data.TruncateToLength}"
        - "${data.Batch}"
    CreateMathQAInputs:
      _target_: "trax.data.CreateMathQAInputs"
      dataset_path: "path_to_the_dataset"
      train: true
      tolerance: 0.01
      cumulative: true
  eval_basic_task:
    make_additional_stream:
      _target_: "trax.data.make_additional_stream"
      stream:
        - "${data.eval_basic_task.CreateMathQAInputs}"
        - "${data.Tokenize}"
        - "${data.Shuffle}"
        - "${data.PadToLength}"
        - "${data.TruncateToLength}"
        - "${data.Batch}"
    CreateMathQAInputs:
      _target_: "trax.data.CreateMathQAInputs"
      dataset_path: "path_to_the_dataset"
      train: false
      tolerance: 0.01
      cumulative: true
  train_rationale_task:
    make_additional_stream:
      _target_: "trax.data.make_additional_stream"
      stream:
        - "${data.train_rationale_task.CreateMathQAInputs}"
        - "${data.Tokenize}"
        - "${data.Shuffle}"
        - "${data.PadToLength}"
        - "${data.TruncateToLength}"
        - "${data.Batch}"
    CreateMathQAInputs:
      _target_: "trax.data.CreateMathQAInputs"
      dataset_path: "path_to_the_dataset"
      train: true
      tolerance: 0.01
      cumulative: false
      nlp_rationale: true
  eval_rationale_task:
    make_additional_stream:
      _target_: "trax.data.make_additional_stream"
      stream:
        - "${data.eval_rationale_task.CreateMathQAInputs}"
        - "${data.Tokenize}"
        - "${data.Shuffle}"
        - "${data.PadToLength}"
        - "${data.TruncateToLength}"
        - "${data.Batch}"
    CreateMathQAInputs:
      _target_: "trax.data.CreateMathQAInputs"
      dataset_path: "path_to_the_dataset"
      train: false
      tolerance: 0.01
      cumulative: false
      nlp_rationale: true
    EvaluationTask:
      _target_: "trax.learning.trainer.EvaluationTask"
      labeled_data: "${data.eval_rationale_task.make_additional_stream}"
      metrics:
        - "${train.WeightedCategoryAccuracy}"
        - "${train.SequenceAccuracy}"
      metric_names:
        - "Rationale accuracy"
        - "Rationale sequence accuracy"
  train_category_task:
    make_additional_stream:
      _target_: "trax.data.make_additional_stream"
      stream:
        - "${data.train_category_task.CreateMathQAInputs}"
        - "${data.Tokenize}"
        - "${data.Shuffle}"
        - "${data.PadToLength}"
        - "${data.TruncateToLength}"
        - "${data.Batch}"
    CreateMathQAInputs:
      _target_: "trax.data.CreateMathQAInputs"
      dataset_path: "path_to_the_dataset"
      train: true
      tolerance: 0.01
      cumulative: false
      category: true
  eval_category_task:
    make_additional_stream:
      _target_: "trax.data.make_additional_stream"
      stream:
        - "${data.eval_category_task.CreateMathQAInputs}"
        - "${data.Tokenize}"
        - "${data.Shuffle}"
        - "${data.PadToLength}"
        - "${data.TruncateToLength}"
        - "${data.Batch}"
    CreateMathQAInputs:
      _target_: "trax.data.CreateMathQAInputs"
      dataset_path: "path_to_the_dataset"
      train: false
      tolerance: 0.01
      cumulative: false
      category: true
    EvaluationTask:
      _target_: "trax.learning.trainer.EvaluationTask"
      labeled_data: "${data.eval_category_task.make_additional_stream}"
      metrics:
        - "${train.WeightedCategoryAccuracy}"
        - "${train.SequenceAccuracy}"
      metric_names:
        - "Category accuracy"
        - "Category sequence accuracy"
  train_correct_answer_task:
    make_additional_stream:
      _target_: "trax.data.make_additional_stream"
      _partial_: true
      stream:
        - "${data.train_correct_answer_task.CreateMathQAInputs}"
        - "${data.Tokenize}"
        - "${data.Shuffle}"
        - "${data.PadToLength}"
        - "${data.TruncateToLength}"
        - "${data.Batch}"
    CreateMathQAInputs:
      _target_: "trax.data.CreateMathQAInputs"
      dataset_path: "path_to_the_dataset"
      train: true
      tolerance: 0.01
      cumulative: false
      correct_answer: true
  eval_correct_answer_task:
    make_additional_stream:
      _target_: "trax.data.make_additional_stream"
      stream:
        - "${data.eval_correct_answer_task.CreateMathQAInputs}"
        - "${data.Tokenize}"
        - "${data.Shuffle}"
        - "${data.PadToLength}"
        - "${data.TruncateToLength}"
        - "${data.Batch}"
    CreateMathQAInputs:
      _target_: "trax.data.CreateMathQAInputs"
      dataset_path: "path_to_the_dataset"
      train: false
      tolerance: 0.01
      cumulative: false
      correct_answer: true
  train_drop_task:
    make_additional_stream:
      _target_: "trax.data.make_additional_stream"
      stream:
        - "${data.train_drop_task.CreateDropInputs}"
        - "${data.Tokenize}"
        - "${data.Shuffle}"
        - "${data.PadToLength}"
        - "${data.TruncateToLength}"
        - "${data.Batch}"
    CreateDropInputs:
      _target_: "trax.data.CreateDropInputs"
      train: true
      mathqa_format: true
  eval_drop_task:
    make_additional_stream:
      _target_: "trax.data.make_additional_stream"
      stream:
        - "${data.eval_drop_task.CreateDropInputs}"
        - "${data.Tokenize}"
        - "${data.Shuffle}"
        - "${data.PadToLength}"
        - "${data.TruncateToLength}"
        - "${data.Batch}"
    CreateDropInputs:
      _target_: "trax.data.CreateDropInputs"
      train: false
      mathqa_format: true
    EvaluationTask:
      _target_: "trax.learning.trainer.EvaluationTask"
      labeled_data: "${data.eval_drop_task.make_additional_stream}"
      metrics:
        - "${train.WeightedCategoryAccuracy}"
        - "${train.SequenceAccuracy}"
      metric_names:
        - "Correct drop accuracy"
        - "Correct drop sequence accuracy"
  train_drop_annot_task:
    make_additional_stream:
      _target_: "trax.data.make_additional_stream"
      _partial_: true
      stream:
        - "${data.train_drop_annot_task.CreateAnnotatedDropInputs}"
        - "${data.Tokenize}"
        - "${data.Shuffle}"
        - "${data.PadToLength}"
        - "${data.TruncateToLength}"
        - "${data.Batch}"
    CreateAnnotatedDropInputs:
      _target_: "trax.data.CreateAnnotatedDropInputs"
      train: true
      dataset_path: "path_to_the_dataset"
      single_file: false
  eval_drop_annot_task:
    make_additional_stream:
      _target_: "trax.data.make_additional_stream"
      stream:
        - "${data.eval_drop_annot_task.CreateAnnotatedDropInputs}"
        - "${data.Tokenize}"
        - "${data.Shuffle}"
        - "${data.PadToLength}"
        - "${data.TruncateToLength}"
        - "${data.Batch}"
    CreateAnnotatedDropInputs:
      _target_: "trax.data.CreateAnnotatedDropInputs"
      train: false
      dataset_path: "dataset_path_drop_eval"
  make_parallel_stream:
    _target_: "trax.data.make_parallel_stream"
    streams:
      - "${data.train_basic_task.make_additional_stream}"
      - "${data.train_full_inference.make_additional_stream}"
      - "${data.train_correct_answer_task.make_additional_stream}"
      - "${data.train_drop_annot_task.make_additional_stream}"
  eval:
    CreateMathQAInputs:
      _target_: "trax.data.CreateMathQAInputs"
      dataset_path: "path_to_the_dataset"
      train: false
      tolerance: 0.01
      cumulative: true
  PadToLength:
    _target_: "trax.data.PadToLength"
    len_map:
      0: 512
      1: 512
      2: 512
    pad_value:
      0: 0
      1: 0
      2: 0
  TruncateToLength:
    _target_: "trax.data.TruncateToLength"
    len_map:
      0: "(512,)"
      1: "(512,)"
      2: "(512,)"
  Batch:
    _target_: "trax.data.Batch"
    batch_size: 4
