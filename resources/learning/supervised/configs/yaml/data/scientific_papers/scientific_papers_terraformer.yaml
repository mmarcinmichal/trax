defaults:
  - /data/base
  - scientific_papers_base
  - _self_

data:
  Rekey:
    _target_: "trax.data.Rekey"
    _partial_: true
    key_map:
      inputs: "article"
      targets: "abstract"
  make_inputs:
    _target_: "trax.data.make_inputs"
    _partial_: true
    train_stream:
      - "${data.train.Stream}"
      - "${data.train.BucketByLength}"
      - "${data.AddLossWeights}"
    eval_stream:
      - "${data.eval.Stream}"
      - "${data.eval.BucketByLength}"
      - "${data.AddLossWeights}"
  train:
    Stream:
      _target_: "trax.data.tf_dataset_streams_serial_train"
      datasets: "${data.dataset_loader}"
      preprocess_fn: "${data.GenericTextPreprocess}"
    BucketByLength:
      _target_: "trax.data.BucketByLengthFromBatcher"
      training: true
      buckets:
        - - 16384
        - - 32
          - 1
      strict_pad_on_len: false
  eval:
    Stream:
      _target_: "trax.data.tf_dataset_streams_serial_eval"
      datasets: "${data.dataset_loader}"
      preprocess_fn: "${data.GenericTextPreprocess}"
    BucketByLength:
      _target_: "trax.data.BucketByLengthFromBatcher"
      training: false
      buckets:
        - - 16384
        - - 32
          - 1
      strict_pad_on_len: false
  AddLossWeights:
    _target_: "trax.data.add_loss_weights"
    _partial_: true
    id_to_mask: 0
  dataset_loader:
    _target_: "trax.data.loader.tf.base.data_streams"
    _partial_: true
    data_dir: null
    dataset_name: "scientific_papers/arxiv:1.1.1"
  FilterByLengthMap:
    _target_: "trax.data.FilterByLengthMap"
    _partial_: true
    len_map:
      inputs: "(1, 16384)"
      targets: "(1, 1024)"
    filter_on_eval: true
  TruncateByLengthMap:
    _target_: "trax.data.TruncateByLengthMap"
    _partial_: true
    len_map:
      inputs: 16384
      targets: 1024
    truncate_on_eval: true
  PadToLengthMap:
    _target_: "trax.data.PadToLengthMap"
    _partial_: true
    len_map:
      inputs: 16384
      targets: 1024
  GenericTextPreprocess:
    _target_: "trax.data.GenericTextPreprocess"
    _partial_: true
    spm_path: "gs://t5-data/vocabs/cc_all.32000/sentencepiece.model"
    text_preprocess_fns:
      - "${data.Rekey}"
    token_preprocess_fns:
      - "${data.AddEOS}"
      - "${data.TruncateByLengthMap}"
      - "${data.FilterByLengthMap}"
      - "${data.PadToLengthMap}"
  AddEOS:
    _target_: "trax.data.AddEOS"
    _partial_: true
